<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalle del Vehículo - Flota</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="styles.css" rel="stylesheet">
    <style>
        .vehicle-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
        }
        .vehicle-info-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .vehicle-tabs-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .back-button {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 25px;
            text-decoration: none;
            transition: all 0.3s ease;
        }
        .back-button:hover {
            background: rgba(255,255,255,0.3);
            color: white;
            transform: translateY(-2px);
        }
        .vehicle-status-badge {
            font-size: 1.1rem;
            padding: 0.5rem 1rem;
            border-radius: 25px;
        }
        .vehicle-metric {
            text-align: center;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 10px;
            margin: 0.5rem 0;
        }
        .vehicle-metric-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
        }
        .vehicle-metric-label {
            font-size: 0.9rem;
            color: #6c757d;
            margin-top: 0.5rem;
        }
    </style>
</head>
<body>
    <!-- Header del Vehículo -->
    <div class="vehicle-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <a href="index.html" class="back-button mb-3 d-inline-block">
                        <i class="fas fa-arrow-left me-2"></i>Volver a Vehículos
                    </a>
                    <h1 id="vehicle-title" class="mb-2">Cargando...</h1>
                    <div class="d-flex align-items-center gap-3">
                        <span id="vehicle-plate" class="h4 mb-0">-</span>
                        <span id="vehicle-year" class="badge bg-light text-dark">-</span>
                        <span id="vehicle-status" class="vehicle-status-badge bg-success">-</span>
                    </div>
                </div>
                <div class="col-md-4 text-end">
                    <div class="d-flex gap-2 justify-content-end">
                        <button onclick="editVehicle()" class="btn btn-light">
                            <i class="fas fa-edit me-2"></i>Editar
                        </button>
                        <button onclick="deleteVehicle()" class="btn btn-outline-light">
                            <i class="fas fa-trash me-2"></i>Eliminar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="row">
            <!-- Información Básica -->
            <div class="col-lg-4 mb-4">
                <div class="vehicle-info-card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i>Información Básica</h5>
                    </div>
                    <div class="card-body">
                        <div id="basic-info">
                            <div class="d-flex justify-content-between mb-3">
                                <span class="text-muted">Marca:</span>
                                <span id="vehicle-brand" class="fw-medium">-</span>
                            </div>
                            <div class="d-flex justify-content-between mb-3">
                                <span class="text-muted">Modelo:</span>
                                <span id="vehicle-model" class="fw-medium">-</span>
                            </div>
                            <div class="d-flex justify-content-between mb-3">
                                <span class="text-muted">Año:</span>
                                <span id="vehicle-year-detail" class="fw-medium">-</span>
                            </div>
                            <div class="d-flex justify-content-between mb-3">
                                <span class="text-muted">Color:</span>
                                <span id="vehicle-color" class="fw-medium">-</span>
                            </div>
                            <div class="d-flex justify-content-between mb-3">
                                <span class="text-muted">VIN:</span>
                                <span id="vehicle-vin" class="fw-medium">-</span>
                            </div>
                            <div class="d-flex justify-content-between mb-3">
                                <span class="text-muted">Arrendadora:</span>
                                <span id="vehicle-arrendadora" class="fw-medium">-</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Métricas -->
                <div class="vehicle-info-card mt-4">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0"><i class="fas fa-chart-line me-2"></i>Métricas</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-6">
                                <div class="vehicle-metric">
                                    <div id="vehicle-price" class="vehicle-metric-value">-</div>
                                    <div class="vehicle-metric-label">Precio Semanal</div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="vehicle-metric">
                                    <div id="vehicle-expenses" class="vehicle-metric-value">-</div>
                                    <div class="vehicle-metric-label">Gastos Admin</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pestañas del Vehículo -->
            <div class="col-lg-8">
                <div class="vehicle-tabs-container">
                    <div class="card-header bg-white border-bottom">
                        <h5 class="mb-0"><i class="fas fa-tabs me-2"></i>Detalles del Vehículo</h5>
                    </div>
                    <div class="card-body p-0">
                        <!-- Sistema de Pestañas -->
                        <div class="vehiculo-tabs">
                            <div class="tab-navigation">
                                <button class="tab-button active" data-tab="general">
                                    <i class="fas fa-info-circle"></i>
                                    Información General
                                </button>
                                <button class="tab-button" data-tab="galeria">
                                    <i class="fas fa-images"></i>
                                    Galería
                                </button>
                                <button class="tab-button" data-tab="tareas">
                                    <i class="fas fa-tasks"></i>
                                    Tareas
                                </button>
                                <button class="tab-button" data-tab="inspecciones">
                                    <i class="fas fa-clipboard-check"></i>
                                    Inspecciones
                                </button>
                                <button class="tab-button" data-tab="bitacora">
                                    <i class="fas fa-comments"></i>
                                    Bitácora
                                </button>
                                <button class="tab-button" data-tab="kilometraje">
                                    <i class="fas fa-tachometer-alt"></i>
                                    Kilometraje
                                </button>
                                <button class="tab-button" data-tab="gps">
                                    <i class="fas fa-satellite-dish"></i>
                                    GPS
                                </button>
                                <button class="tab-button" data-tab="repuestos">
                                    <i class="fas fa-tools"></i>
                                    Repuestos
                                </button>
                            </div>

                            <!-- Contenido de las Pestañas -->
                            <div class="tab-content">
                                <!-- Pestaña: Información General -->
                                <div class="tab-pane active" data-tab-pane="general">
                                    <div class="tab-content-inner">
                                        <div id="general-tab-content">
                                            <p>Cargando información general...</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Pestaña: Galería -->
                                <div class="tab-pane" data-tab-pane="galeria">
                                    <div class="tab-content-inner">
                                        <div id="galeria-tab-content">
                                            <p>Cargando galería...</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Pestaña: Tareas -->
                                <div class="tab-pane" data-tab-pane="tareas">
                                    <div class="tab-content-inner">
                                        <div id="tareas-tab-content">
                                            <p>Cargando tareas...</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Pestaña: Inspecciones -->
                                <div class="tab-pane" data-tab-pane="inspecciones">
                                    <div class="tab-content-inner">
                                        <div id="inspecciones-tab-content">
                                            <p>Cargando inspecciones...</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Pestaña: Bitácora -->
                                <div class="tab-pane" data-tab-pane="bitacora">
                                    <div class="tab-content-inner">
                                        <div id="bitacora-tab-content">
                                            <p>Cargando bitácora...</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Pestaña: Kilometraje -->
                                <div class="tab-pane" data-tab-pane="kilometraje">
                                    <div class="tab-content-inner">
                                        <div id="kilometraje-tab-content">
                                            <p>Cargando kilometraje...</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Pestaña: GPS -->
                                <div class="tab-pane" data-tab-pane="gps">
                                    <div class="tab-content-inner">
                                        <div id="gps-tab-content">
                                            <p>Cargando dispositivos GPS...</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Pestaña: Repuestos -->
                                <div class="tab-pane" data-tab-pane="repuestos">
                                    <div class="tab-content-inner">
                                        <div id="repuestos-tab-content">
                                            <p>Cargando solicitudes de repuestos...</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Supabase Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Application Scripts -->
    <script src="config.js"></script>
    <script src="api.js"></script>
    <script src="app.js"></script>
    <script src="modals.js"></script>
    <script src="vehiculo-tabs.js"></script>
    
    <script>
        let currentVehicleId = null;
        let currentVehicle = null;

        // Obtener ID del vehículo de la URL
        function getVehicleIdFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('id');
        }

        // Cargar datos del vehículo
        async function loadVehicleData() {
            const vehicleId = getVehicleIdFromUrl();
            if (!vehicleId) {
                console.error('No se encontró ID del vehículo en la URL');
                return;
            }

            currentVehicleId = vehicleId;
            console.log('Cargando vehículo ID:', vehicleId);

            try {
                const vehicle = await api.getVehiculo(vehicleId);
                if (vehicle) {
                    currentVehicle = vehicle;
                    displayVehicleData(vehicle);
                    initializeTabs();
                } else {
                    console.error('No se pudo cargar el vehículo');
                }
            } catch (error) {
                console.error('Error cargando vehículo:', error);
            }
        }

        // Mostrar datos del vehículo
        function displayVehicleData(vehicle) {
            // Título y header
            document.getElementById('vehicle-title').textContent = `${vehicle.marcas?.nombre || 'Sin marca'} ${vehicle.modelos?.nombre || 'Sin modelo'}`;
            document.getElementById('vehicle-plate').textContent = vehicle.placa || 'Sin placa';
            document.getElementById('vehicle-year').textContent = vehicle.anio || 'N/A';
            document.getElementById('vehicle-status').textContent = vehicle.estados_inventario?.nombre || 'Sin estado';

            // Información básica
            document.getElementById('vehicle-brand').textContent = vehicle.marcas?.nombre || 'Sin marca';
            document.getElementById('vehicle-model').textContent = vehicle.modelos?.nombre || 'Sin modelo';
            document.getElementById('vehicle-year-detail').textContent = vehicle.anio || 'N/A';
            document.getElementById('vehicle-color').textContent = vehicle.color || 'Sin especificar';
            document.getElementById('vehicle-vin').textContent = vehicle.vin || 'Sin VIN';
            document.getElementById('vehicle-arrendadora').textContent = vehicle.arrendadoras?.nombre || 'Sin asignar';

            // Métricas
            document.getElementById('vehicle-price').textContent = vehicle.precio_semanal ? api.formatCurrency(vehicle.precio_semanal) : 'N/A';
            document.getElementById('vehicle-expenses').textContent = vehicle.gastos_adms ? api.formatCurrency(vehicle.gastos_adms) : 'N/A';

            // Actualizar título de la página
            document.title = `${vehicle.placa} - Detalle del Vehículo - Flota`;
        }

        // Inicializar pestañas
        function initializeTabs() {
            if (window.vehiculoTabsManager) {
                window.vehiculoTabsManager.setVehiculoId(currentVehicleId);
                window.vehiculoTabsManager.initializeTabs();
            }
        }

        // Funciones de botones
        function editVehicle() {
            if (currentVehicle) {
                // Redirigir a la página principal con el modal abierto
                window.location.href = `index.html?edit_vehicle=${currentVehicleId}`;
            }
        }

        function deleteVehicle() {
            if (currentVehicle && confirm(`¿Estás seguro de que quieres eliminar el vehículo ${currentVehicle.placa}?`)) {
                // Implementar eliminación
                console.log('Eliminando vehículo:', currentVehicleId);
            }
        }

        // Cargar datos cuando se carga la página
        window.addEventListener('load', function() {
            loadVehicleData();
        });
    </script>
</body>
</html>
