<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Tarjetas Clickeables - Flota</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="styles.css" rel="stylesheet">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .warning { background-color: #fff3cd; border-color: #ffeaa7; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        .test-info { background: #e3f2fd; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .success-message { background: #e8f5e8; color: #2e7d32; padding: 10px; border-radius: 5px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>üéØ Test Tarjetas Clickeables - Flota</h1>
    
    <div class="test-info">
        <h3>üìã Instrucciones:</h3>
        <ol>
            <li>Haz clic en cualquier parte de una tarjeta de veh√≠culo (excepto los botones)</li>
            <li>Deber√≠as ser redirigido a la p√°gina de detalle del veh√≠culo</li>
            <li>Haz clic en los botones para verificar que no activan el click de la tarjeta</li>
            <li>Verifica que las pesta√±as funcionen en la p√°gina de detalle</li>
        </ol>
    </div>
    
    <div class="success-message">
        <h4>‚úÖ Mejoras Implementadas:</h4>
        <ul>
            <li>‚úÖ Toda la tarjeta es clickeable (excepto botones y enlaces)</li>
            <li>‚úÖ Efectos hover y animaciones agregados</li>
            <li>‚úÖ P√°gina de detalle del veh√≠culo creada</li>
            <li>‚úÖ 8 pesta√±as funcionando en la p√°gina de detalle</li>
            <li>‚úÖ Bot√≥n "Editar" redirige al modal desde la p√°gina de detalle</li>
            <li>‚úÖ Navegaci√≥n fluida entre p√°ginas</li>
        </ul>
    </div>
    
    <div class="test-section info">
        <h3>üöó Veh√≠culos de Prueba</h3>
        <p>Haz clic en cualquier tarjeta para ver el detalle del veh√≠culo con pesta√±as:</p>
        
        <div id="vehicles-container">
            <div class="row" id="vehicles-grid">
                <!-- Las tarjetas se cargar√°n aqu√≠ -->
            </div>
        </div>
    </div>
    
    <div class="test-section info">
        <h3>üìä Estado de la Prueba</h3>
        <div id="test-status">
            <p><strong>Estado:</strong> <span id="status-text">Cargando veh√≠culos...</span></p>
            <p><strong>Veh√≠culos cargados:</strong> <span id="vehicles-count">0</span></p>
            <p><strong>√öltima acci√≥n:</strong> <span id="last-action">-</span></p>
        </div>
    </div>
    
    <!-- Supabase Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Application Scripts -->
    <script src="config.js"></script>
    <script src="api.js"></script>
    <script src="app.js"></script>
    <script src="modals.js"></script>
    <script src="vehiculo-tabs.js"></script>
    
    <script>
        console.log('=== TEST TARJETAS CLICKEABLES INICIADO ===');
        
        function actualizarEstado(mensaje) {
            document.getElementById('status-text').textContent = mensaje;
        }
        
        function actualizarUltimaAccion(accion) {
            document.getElementById('last-action').textContent = accion;
        }
        
        function actualizarContadorVehiculos(count) {
            document.getElementById('vehicles-count').textContent = count;
        }
        
        // Interceptar la funci√≥n openVehiculoDetail para debug
        const originalOpenVehiculoDetail = window.app ? window.app.openVehiculoDetail : null;
        
        // Cargar veh√≠culos de prueba
        async function cargarVehiculosPrueba() {
            try {
                actualizarEstado('Cargando veh√≠culos...');
                
                // Crear veh√≠culos de prueba
                const vehiculosPrueba = [
                    {
                        id: 1,
                        placa: 'ABC123',
                        marcas: { nombre: 'Toyota' },
                        modelos: { nombre: 'Corolla' },
                        anio: 2020,
                        color: 'Blanco',
                        vin: '1HGBH41JXMN109186',
                        arrendadoras: { nombre: 'Arrendadora Central' },
                        estados_inventario: { nombre: 'Disponible' },
                        precio_semanal: 150000,
                        gastos_adms: 25000,
                        created_at: new Date().toISOString()
                    },
                    {
                        id: 2,
                        placa: 'XYZ789',
                        marcas: { nombre: 'Honda' },
                        modelos: { nombre: 'Civic' },
                        anio: 2021,
                        color: 'Azul',
                        vin: '2HGBH41JXMN109187',
                        arrendadoras: { nombre: 'Arrendadora Norte' },
                        estados_inventario: { nombre: 'Rentado' },
                        precio_semanal: 180000,
                        gastos_adms: 30000,
                        created_at: new Date().toISOString()
                    },
                    {
                        id: 3,
                        placa: 'DEF456',
                        marcas: { nombre: 'Nissan' },
                        modelos: { nombre: 'Sentra' },
                        anio: 2019,
                        color: 'Rojo',
                        vin: '3HGBH41JXMN109188',
                        arrendadoras: { nombre: 'Arrendadora Sur' },
                        estados_inventario: { nombre: 'Mantenimiento' },
                        precio_semanal: 140000,
                        gastos_adms: 20000,
                        created_at: new Date().toISOString()
                    }
                ];
                
                // Renderizar tarjetas
                const grid = document.getElementById('vehicles-grid');
                grid.innerHTML = vehiculosPrueba.map(vehiculo => renderVehiculoCard(vehiculo)).join('');
                
                actualizarContadorVehiculos(vehiculosPrueba.length);
                actualizarEstado('Veh√≠culos cargados correctamente');
                actualizarUltimaAccion('Tarjetas renderizadas');
                
                console.log('‚úÖ Veh√≠culos de prueba cargados:', vehiculosPrueba.length);
                
            } catch (error) {
                console.error('‚ùå Error cargando veh√≠culos:', error);
                actualizarEstado('Error cargando veh√≠culos: ' + error.message);
            }
        }
        
        // Funci√≥n para renderizar tarjetas (copiada de app.js)
        function renderVehiculoCard(vehiculo) {
            const estadoClass = 'bg-success'; // Simplificado para la prueba
            
            return `
                <div class="col-lg-4 col-md-6 mb-4" data-vehicle-id="${vehiculo.id}">
                    <div class="card h-100 vehicle-card-clickable" onclick="abrirDetalleVehiculo(${vehiculo.id})" style="cursor: pointer;">
                        <!-- Header de la tarjeta -->
                        <div class="card-header">
                            <div class="d-flex justify-content-between align-items-start">
                                <div class="flex-grow-1">
                                    <div class="h5 mb-1">${vehiculo.placa}</div>
                                    <div class="text-muted small">
                                        ${vehiculo.marcas?.nombre || 'Sin marca'} 
                                        ${vehiculo.modelos?.nombre || 'Sin modelo'}
                                    </div>
                                    ${vehiculo.vin ? `<div class="text-muted small">VIN: ${vehiculo.vin}</div>` : ''}
                                </div>
                                <div class="d-flex flex-column align-items-end gap-1">
                                    <span class="badge bg-secondary small">#${vehiculo.id}</span>
                                    <span class="badge bg-info small">${vehiculo.anio || 'N/A'}</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Body de la tarjeta -->
                        <div class="card-body">
                            <div class="mb-3">
                                <div class="d-flex justify-content-between mb-2">
                                    <span class="text-muted small">Arrendadora</span>
                                    <span class="fw-medium">${vehiculo.arrendadoras?.nombre || 'Sin asignar'}</span>
                                </div>
                                
                                <div class="d-flex justify-content-between mb-2">
                                    <span class="vehicle-card-label">Estado</span>
                                    <span class="badge ${estadoClass}">
                                        ${vehiculo.estados_inventario?.nombre || 'Sin estado'}
                                    </span>
                                </div>
                                
                                ${vehiculo.precio_semanal ? `
                                <div class="d-flex justify-content-between mb-2">
                                    <span class="text-muted small">Precio Semanal</span>
                                    <span class="fw-medium">‚Ç°${vehiculo.precio_semanal.toLocaleString()}</span>
                                </div>
                                ` : ''}
                                
                                ${vehiculo.gastos_adms ? `
                                <div class="d-flex justify-content-between mb-2">
                                    <span class="text-muted small">Gastos Admin</span>
                                    <span class="fw-medium">‚Ç°${vehiculo.gastos_adms.toLocaleString()}</span>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                        
                        <!-- Acciones de la tarjeta -->
                        <div class="card-footer">
                            <div class="d-flex justify-content-between align-items-center">
                                <small class="text-muted">
                                    <i class="fas fa-clock me-1"></i>
                                    ${new Date(vehiculo.created_at).toLocaleDateString()}
                                </small>
                                <div class="btn-group btn-group-sm" onclick="event.stopPropagation();">
                                    <button onclick="probarBotonTareas(${vehiculo.id})" 
                                            class="btn btn-outline-info" 
                                            title="Ver tareas del veh√≠culo">
                                        <i class="fas fa-tasks"></i>
                                    </button>
                                    <button onclick="probarBotonEditar(${vehiculo.id})" 
                                            class="btn btn-outline-primary" 
                                            title="Editar veh√≠culo">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button onclick="probarBotonEliminar(${vehiculo.id})" 
                                            class="btn btn-outline-danger" 
                                            title="Eliminar veh√≠culo">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // Funciones de prueba
        function abrirDetalleVehiculo(id) {
            console.log(`üöó Abriendo detalle del veh√≠culo ID: ${id}`);
            actualizarUltimaAccion(`Click en tarjeta del veh√≠culo ${id}`);
            
            // Simular redirecci√≥n a la p√°gina de detalle
            window.location.href = `vehiculo-detail.html?id=${id}`;
        }
        
        function probarBotonTareas(id) {
            console.log(`üìã Bot√≥n tareas clickeado para veh√≠culo ${id}`);
            actualizarUltimaAccion(`Click en bot√≥n tareas del veh√≠culo ${id}`);
            alert(`Bot√≥n tareas clickeado para veh√≠culo ${id} - No deber√≠a abrir el detalle`);
        }
        
        function probarBotonEditar(id) {
            console.log(`‚úèÔ∏è Bot√≥n editar clickeado para veh√≠culo ${id}`);
            actualizarUltimaAccion(`Click en bot√≥n editar del veh√≠culo ${id}`);
            alert(`Bot√≥n editar clickeado para veh√≠culo ${id} - No deber√≠a abrir el detalle`);
        }
        
        function probarBotonEliminar(id) {
            console.log(`üóëÔ∏è Bot√≥n eliminar clickeado para veh√≠culo ${id}`);
            actualizarUltimaAccion(`Click en bot√≥n eliminar del veh√≠culo ${id}`);
            alert(`Bot√≥n eliminar clickeado para veh√≠culo ${id} - No deber√≠a abrir el detalle`);
        }
        
        // Cargar veh√≠culos cuando se carga la p√°gina
        window.addEventListener('load', function() {
            console.log('üîÑ P√°gina cargada, cargando veh√≠culos de prueba...');
            
            setTimeout(() => {
                cargarVehiculosPrueba();
            }, 500);
        });
    </script>
</body>
</html>
