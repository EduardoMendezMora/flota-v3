<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Modal - Flota</title>
    <style>
        .debug-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .warning { background-color: #fff3cd; border-color: #ffeaa7; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
    </style>
</head>
<body>
    <h1>Debug Modal - Flota</h1>
    
    <div class="debug-section info">
        <h3>1. Verificar Scripts Cargados</h3>
        <div id="scripts-status"></div>
    </div>

    <div class="debug-section info">
        <h3>2. Verificar Objetos Disponibles</h3>
        <div id="objects-status"></div>
    </div>

    <div class="debug-section info">
        <h3>3. Probar Bot√≥n Nuevo Veh√≠culo</h3>
        <button onclick="testNuevoVehiculo()" class="btn btn-primary">Probar Nuevo Veh√≠culo</button>
        <div id="button-test-result"></div>
    </div>

    <div class="debug-section info">
        <h3>4. Verificar Modal Manager</h3>
        <div id="modal-manager-status"></div>
    </div>

    <div class="debug-section info">
        <h3>5. Verificar Vehiculo Tabs Manager</h3>
        <div id="tabs-manager-status"></div>
    </div>

    <!-- Supabase Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Application Scripts -->
    <script src="config.js"></script>
    <script src="api.js"></script>
    <script src="app.js"></script>
    <script src="modals.js"></script>
    <script src="vehiculo-tabs.js"></script>
    
    <script>
        console.log('=== DEBUG MODAL INICIADO ===');
        
        function updateStatus(elementId, content, type = 'info') {
            const element = document.getElementById(elementId);
            if (element) {
                element.innerHTML = content;
                element.className = `debug-section ${type}`;
            }
        }

        function testNuevoVehiculo() {
            console.log('üß™ Probando bot√≥n nuevo veh√≠culo...');
            
            try {
                if (typeof openModal === 'function') {
                    console.log('‚úÖ Funci√≥n openModal disponible');
                    openModal('vehiculo');
                    updateStatus('button-test-result', '‚úÖ Funci√≥n openModal ejecutada correctamente', 'success');
                } else {
                    console.log('‚ùå Funci√≥n openModal no disponible');
                    updateStatus('button-test-result', '‚ùå Funci√≥n openModal no disponible', 'error');
                }
            } catch (error) {
                console.error('‚ùå Error ejecutando openModal:', error);
                updateStatus('button-test-result', `‚ùå Error: ${error.message}`, 'error');
            }
        }

        function checkScriptsStatus() {
            const scripts = [
                { name: 'config.js', check: () => typeof SUPABASE_CONFIG !== 'undefined' },
                { name: 'api.js', check: () => typeof api !== 'undefined' },
                { name: 'app.js', check: () => typeof window.app !== 'undefined' },
                { name: 'modals.js', check: () => typeof ModalManager !== 'undefined' },
                { name: 'vehiculo-tabs.js', check: () => typeof VehiculoTabsManager !== 'undefined' }
            ];

            let status = '';
            scripts.forEach(script => {
                const isLoaded = script.check();
                const icon = isLoaded ? '‚úÖ' : '‚ùå';
                const color = isLoaded ? 'success' : 'error';
                status += `<p class="${color}">${icon} ${script.name}: ${isLoaded ? 'Cargado' : 'No cargado'}</p>`;
            });

            updateStatus('scripts-status', status);
        }

        function checkObjectsStatus() {
            let status = '';
            
            // Verificar window.app
            if (window.app) {
                status += '<p class="success">‚úÖ window.app: Disponible</p>';
                
                // Verificar modalManager
                if (window.app.modalManager) {
                    status += '<p class="success">‚úÖ window.app.modalManager: Disponible</p>';
                } else {
                    status += '<p class="error">‚ùå window.app.modalManager: No disponible</p>';
                }
            } else {
                status += '<p class="error">‚ùå window.app: No disponible</p>';
            }

            // Verificar api
            if (typeof api !== 'undefined') {
                status += '<p class="success">‚úÖ Variable api: Disponible</p>';
            } else {
                status += '<p class="error">‚ùå Variable api: No disponible</p>';
            }

            updateStatus('objects-status', status);
        }

        function checkModalManagerStatus() {
            let status = '';
            
            if (window.app && window.app.modalManager) {
                const modalManager = window.app.modalManager;
                status += '<p class="success">‚úÖ ModalManager instanciado</p>';
                
                // Verificar m√©todos
                if (typeof modalManager.getModalContent === 'function') {
                    status += '<p class="success">‚úÖ getModalContent: Disponible</p>';
                } else {
                    status += '<p class="error">‚ùå getModalContent: No disponible</p>';
                }
                
                if (typeof modalManager.loadModalData === 'function') {
                    status += '<p class="success">‚úÖ loadModalData: Disponible</p>';
                } else {
                    status += '<p class="error">‚ùå loadModalData: No disponible</p>';
                }
            } else {
                status += '<p class="error">‚ùå ModalManager no disponible</p>';
            }

            updateStatus('modal-manager-status', status);
        }

        function checkTabsManagerStatus() {
            let status = '';
            
            if (window.vehiculoTabsManager) {
                status += '<p class="success">‚úÖ VehiculoTabsManager: Disponible</p>';
                
                // Verificar m√©todos
                if (typeof window.vehiculoTabsManager.setVehiculoId === 'function') {
                    status += '<p class="success">‚úÖ setVehiculoId: Disponible</p>';
                } else {
                    status += '<p class="error">‚ùå setVehiculoId: No disponible</p>';
                }
                
                if (typeof window.vehiculoTabsManager.switchTab === 'function') {
                    status += '<p class="success">‚úÖ switchTab: Disponible</p>';
                } else {
                    status += '<p class="error">‚ùå switchTab: No disponible</p>';
                }
            } else {
                status += '<p class="error">‚ùå VehiculoTabsManager: No disponible</p>';
            }

            updateStatus('tabs-manager-status', status);
        }

        // Ejecutar verificaciones cuando se cargue la p√°gina
        window.addEventListener('load', function() {
            console.log('üîÑ P√°gina cargada, ejecutando verificaciones...');
            
            // Esperar un poco para que todos los scripts se inicialicen
            setTimeout(() => {
                checkScriptsStatus();
                checkObjectsStatus();
                checkModalManagerStatus();
                checkTabsManagerStatus();
            }, 1000);
        });
    </script>
</body>
</html>
